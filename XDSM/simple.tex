% IDF architecture diagram produced by the TikZ package
\documentclass{article}
\usepackage{geometry}
\usepackage{amsfonts}
\usepackage{amsmath}
\usepackage{amssymb}

\usepackage{tikz}

\input{diagram_border}

\begin{document}

% Style definition outside any picture
\input{diagram_styles}

\begin{tikzpicture}

	% Use a matrix to line up all the nodes 
    \matrix[MatrixSetup]{
		% First row
		& \node [DataIO](input_x){$x^{(0)}$};
		&
		& \node [DataInter](input_y){$y^{(0)}$};
		& \node [DataInter](input_z){$z^{(0)}$};
		& 
		&
		\\
		% second row
		\node [DataIO] (x_output) {$x^*$};
		& \node [Optimization] (opt) {\MultilineComponent{2.3cm}{0,7$\rightarrow$1:}{Optimization}};
		& 
		& \node [DataInter](opt-x1){$1:x$};
		& \node [DataInter](opt-x2){$1:x$};
		& 
		&
		\\
		% third row
		& 
		& \node [MDA] (mda) {\MultilineComponent{1.5cm}{1, 5$\rightarrow$2:}{MDA}};
		& 
		& 
		& 
		& 
		\\
		% fourth row
		\node [DataIO] (y_output) {$y^*$};
		& 
		& 
		& \node [Analysis] (A) {\MultilineComponent{1.6cm}{2:}{A}};
		& 
		& \node [DataInter](mda-z){$2:z^t$};
		& \node [DataInter](mda-m){$6:m$};
		\\
		% fifth row
		\node [DataIO] (z_output) {$z^*$};
		& 
		& 
		& 
		& \node [Analysis] (B) {\MultilineComponent{1.6cm}{3:}{B}};
		& \node [DataInter](mda-y){$3:y^t$};
		& 
		\\
		% sixth row
		& 
		& \node [DataInter](mda-g){$5:g1,g2$};
		& 
		& 
		& \node [Function] (constraints) {\MultilineComponent{1.6cm}{4:}{Const.}}; 
		& 
		\\
		% seventh row
		& \node [DataInter](opt-f){$7:f$};
		& 
		& 
		& 
		& 
		& \node [Function] (objective) {\MultilineComponent{1.6cm}{6:}{Objective}}; 
		\\
	};
	
	% Now define edges to tie the nodes together, using chains	
	{ [start chain=process]
		\begin{pgfonlayer}{process}
		\chainin (input_x);
		\chainin (opt)		[join=by ProcessTip];
		\chainin (mda)		[join=by ProcessHV];
		\chainin (A)		[join=by ProcessHV];
		\chainin (B)		[join=by ProcessHV];
		\chainin (constraints)		[join=by ProcessHV];
		\chainin (mda)		[join=by ProcessHV];
		\chainin (objective)	[join=by ProcessHV];
		\chainin (opt) [join=by ProcessHV];
		\chainin (x_output)	[join=by ProcessTip];
		\end{pgfonlayer}
	}
	
	\begin{pgfonlayer}{data}
	% Vertical edges
	\path (input_x) edge [DataLine] (opt-f)
	(input_y) edge [DataLine] (A)
	(input_z) edge [DataLine] (B)
	(mda-z) edge [DataLine] (constraints)
	(mda-m) edge [DataLine] (objective)
	(input_x) edge [DataLine] (opt)
	(opt) edge [DataLine] (opt-x1)
	(opt) edge [DataLine] (opt-x2)
	(A) edge [DataLine] (mda-z)
	(A) edge [DataLine] (mda-m)
	(B) edge [DataLine] (mda-y)
	(constraints) edge [DataLine] (mda-g)
	(mda-g) edge [DataLine] (mda)
	(objective) edge [DataLine] (opt-f)
	(y_output) edge [DataLine] (A)
	(z_output) edge [DataLine] (B)
;
	\end{pgfonlayer}
	
\end{tikzpicture}

\end{document}